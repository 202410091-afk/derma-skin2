<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ai-Derma | ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø¯ Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #f4f7f6; margin: 0; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        h1 { font-size: 1.2rem; color: #333; margin-bottom: 5px; }
        #project-info { font-size: 0.8rem; color: #666; margin-bottom: 15px; }
        #video-wrap { width: 100%; aspect-ratio: 1/1; background: #000; border-radius: 10px; overflow: hidden; margin-bottom: 15px; }
        video { width: 100%; height: 100%; object-fit: cover; }
        button { background-color: #28a745; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 1rem; width: 100%; font-weight: bold; }
        button:disabled { background-color: #ccc; }
        #results { margin-top: 15px; padding: 10px; background: #eee; border-radius: 5px; text-align: left; font-family: monospace; white-space: pre-wrap; font-size: 0.9rem; min-height: 50px; }
    </style>
</head>
<body>

<div class="card">
    <h1 id="title">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„...</h1>
    <div id="project-info"></div>

    <div id="video-wrap">
        <video id="webcam" autoplay muted playsinline></video>
    </div>

    <button id="run-inference" disabled>Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</button>

    <div id="results">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...</div>
</div>

<script src="edge-impulse-standalone.js"></script>

<script>
    (async () => {
        const video = document.querySelector('#webcam');
        const btn = document.querySelector('#run-inference');
        const resultsDesc = document.querySelector('#results');
        const title = document.querySelector('#title');
        
        try {
            // 1. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØµÙ†Ù
            var classifier = new EdgeImpulseClassifier();
            await classifier.init();

            // 2. Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
            let project = classifier.getProjectInfo();
            title.textContent = "ğŸ©º Ai-Derma";
            document.querySelector('#project-info').textContent = `${project.name} (v${project.deploy_version})`;

            // 3. ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            video.srcObject = stream;

            btn.disabled = false;
            btn.textContent = "Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¢Ù†";

            // 4. Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
            btn.onclick = async () => {
                btn.disabled = true;
                btn.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...";
                
                try {
                    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¥Ù„Ù‰ Features
                    const features = getFeaturesFromVideo(video);
                    
                    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ†ØªØ§Ø¬
                    let res = classifier.classify(features);
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø´ÙƒÙ„ Ù…Ø±ØªØ¨
                    resultsDesc.textContent = JSON.stringify(res, null, 4);
                } catch (ex) {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„: ' + (ex.message || ex.toString()));
                } finally {
                    btn.disabled = false;
                    btn.textContent = "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙØ­Øµ";
                }
            };
        } catch (e) {
            title.textContent = "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª";
            resultsDesc.textContent = "ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØ§Øª .js Ùˆ .wasm ÙÙŠ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.";
        }

        // ÙˆØ¸ÙŠÙØ© ØªØ­ÙˆÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø±Ù‚Ù…ÙŠØ©
        function getFeaturesFromVideo(videoElem) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙŠØ¬Ø¨ Ø£Ù† ØªØ·Ø§Ø¨Ù‚ Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ (ØºØ§Ù„Ø¨Ø§Ù‹ 96x96 ÙÙŠ Edge Impulse)
            canvas.width = 96; 
            canvas.height = 96;
            
            ctx.drawImage(videoElem, 0, 0, canvas.width, canvas.height);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
            
            let features = [];
            for (let i = 0; i < imageData.length; i
