<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ai-Derma | ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø¯ Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        :root { --success: #27ae60; --dark: #2c3e50; --bg: #f5f6fa; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg); margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .app-container { background: white; width: 90%; max-width: 400px; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); padding: 25px; text-align: center; }
        .header h1 { color: var(--dark); margin: 0; font-size: 24px; letter-spacing: -1px; }
        #status { font-size: 14px; color: #95a5a6; margin: 10px 0; }
        
        #video-container { width: 100%; aspect-ratio: 1/1; border-radius: 20px; overflow: hidden; margin-bottom: 20px; background: #000; border: 4px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        video { width: 100%; height: 100%; object-fit: cover; }
        
        .btn-scan { background: var(--dark); color: white; border: none; padding: 18px; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; }
        .btn-scan:disabled { background: #dcdde1; color: #7f8c8d; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        #result-area { margin-top: 20px; display: none; }
        .result-title { font-size: 14px; color: #7f8c8d; margin-bottom: 10px; display: block; }
        .result-tag { 
            display: inline-block; 
            background-color: #eafaf1; 
            color: var(--success); 
            padding: 10px 20px; 
            border-radius: 50px; 
            font-size: 20px; 
            font-weight: bold; 
            border: 2px solid var(--success);
            margin: 5px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1>ğŸ©º Ai-Derma</h1>
        <div id="status">Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…...</div>
    </div>

    <div id="video-container">
        <video id="webcam" autoplay muted playsinline></video>
    </div>

    <button id="run-btn" class="btn-scan" disabled>Ø§Ù†ØªØ¸Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</button>
    
    <div id="result-area">
        <span class="result-title">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ´ÙØ©:</span>
        <div id="tags-container">
            </div>
    </div>
</div>

<script src="edge-impulse-standalone.js"></script>
<script src="run-impulse.js"></script>

<script>
    (async () => {
        const video = document.querySelector('#webcam');
        const runBtn = document.querySelector('#run-btn');
        const resultArea = document.querySelector('#result-area');
        const tagsContainer = document.querySelector('#tags-container');
        const status = document.querySelector('#status');

        try {
            const classifier = new EdgeImpulseClassifier();
            await classifier.init();
            
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            video.srcObject = stream;

            status.textContent = "Ø¬Ø§Ù‡Ø² Ù„Ù„ÙØ­Øµ âœ…";
            runBtn.disabled = false;
            runBtn.textContent = "ØªØ­Ù„ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø¯";

            runBtn.onclick = async () => {
                runBtn.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...";
                runBtn.disabled = true;

                const features = getFeaturesFromVideo(video);
                const res = classifier.classify(features);

                if (res.results && res.results.length > 0) {
                    showTags(res.results);
                }

                runBtn.disabled = false;
                runBtn.textContent = "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙØ­Øµ";
            };

        } catch (e) {
            status.textContent = "Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„ÙƒØ§Ù…ÙŠØ±Ø§";
        }

        function showTags(results) {
            tagsContainer.innerHTML = "";
            resultArea.style.display = "block";

            // ÙÙ„ØªØ±Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬: Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙŠ Ø§ÙƒØªØ´ÙÙ‡Ø§ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ ÙÙ‚Ø· (Ø¨Ù†Ø³Ø¨Ø© Ø«Ù‚Ø© Ù…Ø¹Ù‚ÙˆÙ„Ø©)
            // Ù‚Ù…Øª Ø¨Ø¶Ø¨Ø·Ù‡Ø§ Ù„ØªØ¸Ù‡Ø± Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙŠ ØªØ²ÙŠØ¯ Ù†Ø³Ø¨ØªÙ‡Ø§ Ø¹Ù† 15% Ù„ØªÙƒÙˆÙ† Ø¯Ù‚ÙŠÙ‚Ø©
            const detected = results.filter(r => r.value > 0.15).sort((a, b) => b.value - a.value);

            detected.forEach(item => {
                const tag = document.createElement('span');
                tag.className = 'result-tag';
                tag.textContent = item.label; // Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ù„Ø© ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø£Ø±Ù‚Ø§Ù…
                tagsContainer.appendChild(tag);
            });
        }

        function getFeaturesFromVideo(v) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 96; canvas.height = 96;
            ctx.drawImage(v, 0, 0, 96, 96);
            const d = ctx.getImageData(0, 0, 96, 96).data;
            let f = [];
            for (let i = 0; i < d.length; i += 4) {
                f.push((d[i] << 16) | (d[i+1] << 8) | d[i+2]);
            }
            return f;
        }
    })();
</script>

</body>
</html>
